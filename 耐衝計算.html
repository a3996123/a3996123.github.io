<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>耐衝計算器（三合一）</title>

    <!-- Bulma + Font Awesome，跟 spec_viewer 一樣 -->
    <link
        rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.9.4/css/bulma.min.css"
    />
    <script
        defer
        src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/js/all.min.js"
    ></script>

    <style>
        /* === 核心底色 & 字型：沿用 spec_viewer 風格 === */
        html, body {
            height: 100%;
            background: linear-gradient(120deg, #f0f4ff, #e6f7ff);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
                "Helvetica Neue", Arial, "Noto Sans TC", "微軟正黑體", sans-serif;
        }

        .main-layout {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .main-content {
            flex: 1;
            padding: 1.5rem;
        }

        /* 卡片樣式：跟 spec_viewer 一致 */
        .card {
            border-radius: 18px;
            box-shadow: 0 16px 40px rgba(15, 23, 42, 0.12);
            height: 100%;
        }

        .card-header {
            border-bottom: none;
            background: linear-gradient(
                135deg,
                rgba(59, 130, 246, 0.12),
                rgba(56, 189, 248, 0.08)
            );
        }

        .card-header-title {
            font-weight: 700;
            color: #1e293b;
        }

        .tag.badge-pill {
            border-radius: 999px;
            padding-inline: 0.85em;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .is-soft-blue { background: rgba(59, 130, 246, 0.12); color: #1d4ed8; }
        .is-soft-green { background: rgba(16, 185, 129, 0.12); color: #047857; }
        .is-soft-orange { background: rgba(251, 146, 60, 0.12); color: #c05621; }

        .input,
        .button {
            border-radius: 999px;
            box-shadow: none;
        }

        .input {
            border: 1px solid #e5e7eb;
        }

        .button.is-primary {
            background: linear-gradient(135deg, #2563eb, #3b82f6);
            box-shadow: 0 10px 25px rgba(37, 99, 235, 0.35);
            border: none;
        }

        /* readOnly 欄位視覺區隔 */
        input[readonly] {
            background-color: rgba(230, 240, 255, 0.5);
            color: #1d4ed8;
            font-weight: 600;
            text-align: center;
        }

        /* 桌機橫排、手機直排：用 Bulma columns 控制 */
        /* Bulma 預設：桌機 is-4 會三欄橫排，手機自動直排，這裡只微調間距 */
        @media (max-width: 768px) {
            .card { margin-bottom: 1rem; }
        }
    </style>
</head>
<body>
<div class="main-layout">
    <!-- 簡單標題列（可依需要改掉） -->
    <section class="section pb-2">
        <div class="container">
            <h1 class="title is-4 has-text-centered">
                <span class="icon-text">
                    <span class="icon has-text-info">
                        <i class="fas fa-bolt"></i>
                    </span>
                    <span>耐衝計算器（三合一）</span>
                </span>
            </h1>
            <p class="has-text-centered has-text-grey is-size-7">
                桌機：橫向三欄排列 ／ 手機：直向一欄排列
            </p>
        </div>
    </section>

    <section class="main-content">
        <div class="container">
            <div class="columns is-variable is-5 is-multiline">
                <!-- 計算器 1：kg-cm/cm² 對照表 -->
                <div class="column is-4-desktop is-12-tablet">
                    <div class="card">
                        <header class="card-header">
                            <p class="card-header-title">
                                <span class="icon mr-2 has-text-info">
                                    <i class="fas fa-table"></i>
                                </span>
                                耐衝計算器（kg-cm/cm² 對照表）
                            </p>
                            <div class="card-header-icon">
                                <span class="tag badge-pill is-soft-blue">查表</span>
                            </div>
                        </header>
                        <div class="card-content">
                            <div class="field">
                                <label class="label is-small">
                                    輸入數值
                                    <span class="tag is-light is-rounded is-size-7 ml-1">
                                        kg-cm/cm²
                                    </span>
                                </label>
                                <div class="control">
                                    <input
                                        type="number"
                                        step="0.01"
                                        id="inputVal"
                                        class="input"
                                        placeholder="請輸入..."
                                        onkeydown="if(event.key==='Enter') calculateTable()"
                                    />
                                </div>
                            </div>

                            <div class="field">
                                <label class="label is-small">
                                    計算結果
                                    <span class="tag is-light is-rounded is-size-7 ml-1">
                                        對應值
                                    </span>
                                </label>
                                <div class="control">
                                    <input
                                        type="text"
                                        id="tableResult"
                                        class="input"
                                        readonly
                                        placeholder="等待計算..."
                                    />
                                </div>
                            </div>

                            <div class="field mt-4">
                                <button class="button is-primary is-fullwidth"
                                        onclick="calculateTable()">
                                    <span class="icon"><i class="fas fa-play"></i></span>
                                    <span>開始計算</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 計算器 2：耐衝計算 I -->
                <div class="column is-4-desktop is-12-tablet">
                    <div class="card">
                        <header class="card-header">
                            <p class="card-header-title">
                                <span class="icon mr-2 has-text-success">
                                    <i class="fas fa-exchange-alt"></i>
                                </span>
                                耐衝計算 I
                            </p>
                            <div class="card-header-icon">
                                <span class="tag badge-pill is-soft-green">新→舊</span>
                            </div>
                        </header>
                        <div class="card-content">
                            <div class="field">
                                <label class="label is-small">輸入值（新耐衝 kg-cm）</label>
                                <div class="control">
                                    <input
                                        type="number"
                                        id="inputField1"
                                        class="input"
                                        placeholder="輸入新耐衝 kg-cm"
                                        onkeydown="if(event.key==='Enter') calculateI()"
                                    />
                                </div>
                            </div>

                            <div class="field">
                                <label class="label is-small">舊耐衝 (kg-cm)</label>
                                <div class="control">
                                    <input type="text" id="result1_1" class="input" readonly>
                                </div>
                            </div>

                            <div class="field">
                                <label class="label is-small">新耐衝 (kg-cm/cm)</label>
                                <div class="control">
                                    <input type="text" id="result1_2" class="input" readonly>
                                </div>
                            </div>

                            <div class="field">
                                <label class="label is-small">新耐衝 (kg-cm/cm²)</label>
                                <div class="control">
                                    <input type="text" id="result1_3" class="input" readonly>
                                </div>
                            </div>

                            <div class="field mt-4">
                                <button class="button is-primary is-fullwidth"
                                        onclick="calculateI()">
                                    <span class="icon"><i class="fas fa-play"></i></span>
                                    <span>開始計算</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 計算器 3：耐衝計算 II -->
                <div class="column is-4-desktop is-12-tablet">
                    <div class="card">
                        <header class="card-header">
                            <p class="card-header-title">
                                <span class="icon mr-2 has-text-warning">
                                    <i class="fas fa-retweet"></i>
                                </span>
                                耐衝計算 II
                            </p>
                            <div class="card-header-icon">
                                <span class="tag badge-pill is-soft-orange">舊→新</span>
                            </div>
                        </header>
                        <div class="card-content">
                            <div class="field">
                                <label class="label is-small">輸入值（舊耐衝 kg-cm）</label>
                                <div class="control">
                                    <input
                                        type="number"
                                        id="inputField2"
                                        class="input"
                                        placeholder="輸入舊耐衝 kg-cm"
                                        onkeydown="if(event.key==='Enter') calculateII()"
                                    />
                                </div>
                            </div>

                            <div class="field">
                                <label class="label is-small">舊耐衝 (kg-cm) 查表</label>
                                <div class="control">
                                    <input type="text" id="output4" class="input" readonly>
                                </div>
                            </div>

                            <div class="field">
                                <label class="label is-small">新耐衝 (kg-cm)</label>
                                <div class="control">
                                    <input type="text" id="output1" class="input" readonly>
                                </div>
                            </div>

                            <div class="field">
                                <label class="label is-small">新耐衝 (kg-cm/cm)</label>
                                <div class="control">
                                    <input type="text" id="output2" class="input" readonly>
                                </div>
                            </div>

                            <div class="field">
                                <label class="label is-small">新耐衝 (kg-cm/cm²)</label>
                                <div class="control">
                                    <input type="text" id="output3" class="input" readonly>
                                </div>
                            </div>

                            <div class="field mt-4">
                                <button class="button is-primary is-fullwidth"
                                        onclick="calculateII()">
                                    <span class="icon"><i class="fas fa-play"></i></span>
                                    <span>開始計算</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

            </div> <!-- /.columns -->
        </div>
    </section>
</div>

<script>
    // 共用對照表
    const lookupTable = {
        29.25: 77, 28.80: 78, 28.34: 79, 27.88: 80, 27.42: 81, 26.99: 82, 26.49: 83, 26.02: 84,
        25.56: 85, 25.09: 86, 24.62: 87, 24.16: 88, 23.69: 89, 23.22: 90, 22.75: 91, 22.29: 92,
        21.82: 93, 21.35: 94, 20.88: 95, 20.42: 96, 19.95: 97, 19.49: 98, 19.03: 99, 18.56: 100,
        18.10: 101, 17.65: 102, 17.19: 103, 16.73: 104, 16.28: 105, 15.83: 106, 15.38: 107, 14.93: 108,
        14.49: 109, 14.05: 110, 13.61: 111, 13.18: 112, 12.74: 113, 12.31: 114, 11.89: 115, 11.47: 116,
        11.05: 117, 10.63: 118, 10.22: 119, 9.81: 120, 9.41: 121, 9.01: 122, 8.62: 123, 8.24: 124,
        7.84: 125, 7.46: 126, 7.08: 127, 6.71: 128, 6.35: 129, 5.99: 130, 5.63: 131, 5.28: 132,
        4.93: 133, 4.59: 134, 4.26: 135, 3.93: 136, 3.61: 137, 3.29: 138, 2.98: 139, 2.68: 140,
        2.38: 141, 2.09: 142, 1.81: 143, 1.53: 144, 1.26: 145, 0.99: 146, 0.73: 147, 0.48: 148,
        0.24: 149, 0.00: 150
    };

    // 共用：找最接近 key
    function findClosestKey(value) {
        let minDiff = Infinity;
        let closestKey = null;
        for (const keyStr in lookupTable) {
            const keyNum = parseFloat(keyStr);
            const diff = Math.abs(keyNum - value);
            if (diff < minDiff) {
                minDiff = diff;
                closestKey = keyStr;
            }
        }
        return closestKey;
    }

    // 計算器 1：大字版查表
    function calculateTable() {
        const inputEl = document.getElementById("inputVal");
        const tableResultEl = document.getElementById("tableResult");
        const inputVal = parseFloat(inputEl.value);

        if (isNaN(inputVal)) {
            tableResultEl.value = "請輸入有效數字";
            return;
        }

        // 隱藏公式：輸入值 * 0.317 + 2.2
        const calculatedBase = (inputVal * 0.317) + 2.2;
        const closestKey = findClosestKey(calculatedBase);

        if (closestKey !== null) {
            tableResultEl.value = `${lookupTable[closestKey]}(${closestKey})`;
        } else {
            tableResultEl.value = "無對應值";
        }
    }

    // 計算器 2：耐衝計算 I
    function calculateI() {
        const inputField1 = document.getElementById("inputField1");
        const result1_1 = document.getElementById("result1_1");
        const result1_2 = document.getElementById("result1_2");
        const result1_3 = document.getElementById("result1_3");

        if (inputField1.value === "") {
            result1_1.value = "";
            result1_2.value = "";
            result1_3.value = "";
            return;
        }

        const inputValue1 = parseFloat(inputField1.value);
        if (isNaN(inputValue1)) {
            result1_1.value = "請輸入有效數字";
            result1_2.value = "";
            result1_3.value = "";
            return;
        }

        const calculatedValue1 = inputValue1 + 2.2;
        const calculatedValue1_2 = inputValue1 + ((Math.random() - 0.5) * 0.6);
        const closestKey1 = findClosestKey(calculatedValue1);

        if (closestKey1 !== null) {
            result1_1.value = lookupTable[closestKey1] + " (" + closestKey1 + ")";
        } else {
            result1_1.value = "查無對應值";
        }

        result1_2.value = (calculatedValue1_2 / 0.317).toFixed(2);
        result1_3.value = (calculatedValue1_2 / 0.317 / 1.036).toFixed(1);
    }

    // 計算器 3：耐衝計算 II
    function calculateII() {
        const inputField2 = document.getElementById("inputField2");
        const output1El = document.getElementById("output1");
        const output2El = document.getElementById("output2");
        const output3El = document.getElementById("output3");
        const output4El = document.getElementById("output4");

        if (inputField2.value === "") {
            output1El.value = "";
            output2El.value = "";
            output3El.value = "";
            output4El.value = "";
            return;
        }

        const inputValue2 = parseFloat(inputField2.value);
        if (isNaN(inputValue2)) {
            output1El.value = "請輸入有效數字";
            output2El.value = "";
            output3El.value = "";
            output4El.value = "";
            return;
        }

        const randomOffset = Math.random() * 0.2 - 0.1;
        const output1 = inputValue2 - 2.2 + randomOffset; // 新耐衝 kg-cm
        const output2 = output1 / 0.317;                  // kg-cm/cm
        const output3 = output2 / 1.023;                  // kg-cm/cm²

        const formattedInput = inputValue2.toFixed(2);
        const output4 = lookupTable.hasOwnProperty(formattedInput)
            ? lookupTable[formattedInput] + " (" + formattedInput + ")"
            : "N/A";

        output1El.value = output1.toFixed(2);
        output2El.value = output2.toFixed(2);
        output3El.value = output3.toFixed(1);
        output4El.value = output4;
    }
</script>
</body>
</html>
