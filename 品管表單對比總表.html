<!DOCTYPE html>
<html lang="zh-Hant">
<head>
Â  <meta charset="UTF-8" />
Â  <title>Excel QC Comparator</title>
Â  <link rel="preconnect" href="https://fonts.googleapis.com">
Â  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
Â  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
Â Â 
Â  <style>
Â  Â  :root {
Â  Â  Â  --bg-color: #1d1e22;
Â  Â  Â  --surface-color: #2c2d32;
Â  Â  Â  --primary-color: #4a8eff;
Â  Â  Â  --primary-hover: #6ea3ff;
Â  Â  Â  --text-color: #e0e0e0;
Â  Â  Â  --border-color: #444;
Â  Â  Â  --low-bg: rgba(255, 107, 107, 0.2);
Â  Â  Â  --low-text: #ff8c8c;
Â  Â  Â  --high-bg: rgba(29, 201, 141, 0.2);
Â  Â  Â  --high-text: #59f9c7;
Â  Â  }
Â  Â  * { box-sizing: border-box; margin: 0; padding: 0; }
Â  Â  body { font-family: 'Poppins', sans-serif; background: var(--bg-color); color: var(--text-color); padding: 2em; display: flex; justify-content: center; align-items: flex-start; min-height: 100vh; }
Â  Â  .container { width: 100%; max-width: 95vw; }
Â  Â  .controls-panel { background: var(--surface-color); padding: 2em; border-radius: 12px; margin-bottom: 2em; box-shadow: 0 10px 20px rgba(0,0,0,0.2); border: 1px solid var(--border-color); text-align: center; }
Â  Â  h2 { font-size: 2.5em; font-weight: 600; color: #fff; margin-bottom: 1em; text-shadow: 0 0 10px rgba(74, 142, 255, 0.5); }
Â  Â  .control-group { display: flex; flex-wrap: wrap; justify-content: center; align-items: center; gap: 1.5em; }
Â  Â  select, button, label { font-size: 1em; font-family: 'Poppins', sans-serif; border-radius: 8px; border: 1px solid var(--border-color); background: var(--bg-color); color: var(--text-color); padding: 0.8em 1.2em; transition: all 0.3s ease; }
Â  Â  select:focus, input:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 10px rgba(74, 142, 255, 0.5); }
Â  Â  button { background: var(--primary-color); color: white; border: none; cursor: pointer; font-weight: 500; }
Â  Â  button:hover { background: var(--primary-hover); transform: translateY(-2px); box-shadow: 0 4px 15px rgba(74, 142, 255, 0.4); }
Â  Â  #output { background: var(--surface-color); padding: 2em; border-radius: 12px; box-shadow: 0 10px 20px rgba(0,0,0,0.2); border: 1px solid var(--border-color); }
Â  Â  table { border-collapse: collapse; width: 100%; font-size: 0.85em; table-layout: fixed; word-break: break-all; }
Â  Â  th { background: var(--primary-color); color: white; padding: 0.8em 0.5em; font-weight: 600; }
Â  Â  th:first-child { border-top-left-radius: 8px; }
Â  Â  th:last-child { border-top-right-radius: 8px; }
Â  Â  td { border-bottom: 1px solid var(--border-color); padding: 0.7em 0.5em; text-align: center; transition: background-color 0.3s ease; }
Â  Â  tbody tr:hover { background-color: rgba(255, 255, 255, 0.05); }
Â  Â  tbody tr:last-child td { border-bottom: none; }
Â  Â  .low { background-color: var(--low-bg); color: var(--low-text); font-weight: 600; }
Â  Â  .high { background-color: var(--high-bg); color: var(--high-text); font-weight: 600; }
Â  Â  #loadingStatus { font-weight: 500; color: var(--primary-hover); }
Â  </style>
</head>
<body>
Â Â 
Â  <div class="container">
Â  Â  <div class="controls-panel">
Â  Â  Â  Â  <h2>Excel QC Comparator âœ¨</h2>
Â  Â  Â  Â  <div class="control-group">
Â  Â  Â  Â  Â  Â  <label>
Â  Â  Â  Â  Â  Â  Â  é¸æ“‡åˆ†é ï¼š
Â  Â  Â  Â  Â  Â  Â  <select id="sheetSelect"><option>è®€å–ä¸­...</option></select>
Â  Â  Â  Â  Â  Â  </label>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <label>
Â  Â  Â  Â  Â  Â  Â  é¸æ“‡è£½é€ æ—¥æœŸï¼š
Â  Â  Â  Â  Â  Â  Â  <select id="dateSelect"><option value="">å…¨éƒ¨</option></select>
Â  Â  Â  Â  Â  Â  </label>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <button onclick="compareData()">ğŸš€ åŸ·è¡Œæ¯”å°</button>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <div id="loadingStatus"></div>
Â  Â  Â  Â  </div>
Â  Â  </div>
Â  Â Â 
Â  Â  <div id="output"></div>
Â  </div>

Â  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
Â  <script>
Â  Â  let workbook, refSheetMap = new Map();
Â  Â  let sheetDataCache = {};
Â  Â  let headersCache = {};

Â  Â  window.onload = function() {
Â  Â  Â  Â  const excelFilePath = 'data/æˆå“å“è³ªæª¢é©—è¡¨2025.xlsx';Â 
Â  Â  Â  Â  const loadingStatus = document.getElementById('loadingStatus');
Â  Â  Â  Â Â 
Â  Â  Â  Â  loadingStatus.textContent = 'æ­£åœ¨è®€å– Excel æª”æ¡ˆ...';

Â  Â  Â  Â  fetch(excelFilePath)
Â  Â  Â  Â  Â  Â  .then(response => {
Â  Â  Â  Â  Â  Â  Â  Â  if (!response.ok) throw new Error('ç„¡æ³•è¼‰å…¥ Excel æª”æ¡ˆ');
Â  Â  Â  Â  Â  Â  Â  Â  return response.arrayBuffer();
Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  Â  Â  .then(data => {
Â  Â  Â  Â  Â  Â  Â  Â  const dataArray = new Uint8Array(data);
Â  Â  Â  Â  Â  Â  Â  Â  workbook = XLSX.read(dataArray, { type: 'array' });
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const refSheet = XLSX.utils.sheet_to_json(workbook.Sheets['ç¸½è¡¨'], { header: 1 });
Â  Â  Â  Â  Â  Â  Â  Â  refSheetMap.clear();
Â  Â  Â  Â  Â  Â  Â  Â  for (let i = 1; i < refSheet.length; i++) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const row = refSheet[i];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!row[1]) continue;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  refSheetMap.set(String(row[1]), row);
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  const sheetSelect = document.getElementById('sheetSelect');
Â  Â  Â  Â  Â  Â  Â  Â  sheetSelect.innerHTML = '<option value="">è«‹é¸æ“‡</option>';
Â  Â  Â  Â  Â  Â  Â  Â  workbook.SheetNames.forEach(name => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (name !== 'ç¸½è¡¨') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const opt = document.createElement('option');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  opt.value = name;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  opt.textContent = name;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  sheetSelect.appendChild(opt);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  loadingStatus.textContent = 'Excel è®€å–æˆåŠŸï¼';
Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  Â  Â  .catch(error => {
Â  Â  Â  Â  Â  Â  Â  Â  console.error(error);
Â  Â  Â  Â  Â  Â  Â  Â  loadingStatus.textContent = `éŒ¯èª¤ï¼š${error.message}`;
Â  Â  Â  Â  Â  Â  Â  Â  loadingStatus.style.color = 'var(--low-text)';
Â  Â  Â  Â  Â  Â  });
Â  Â  };

Â  Â  document.getElementById('sheetSelect').addEventListener('change', () => {
Â  Â  Â  const sheetName = document.getElementById('sheetSelect').value;
Â  Â  Â  if (!sheetName || !workbook) return;

Â  Â  Â  if (!sheetDataCache[sheetName]) {
Â  Â  Â  Â  Â  const sheet = XLSX.utils.sheet_to_json(workbook.Sheets[sheetName], { header: 1 });
Â  Â  Â  Â  Â  headersCache[sheetName] = sheet.length > 0 ? sheet[0] : [];
Â  Â  Â  Â  Â  sheetDataCache[sheetName] = sheet.slice(1);
Â  Â  Â  }
Â  Â  Â Â 
Â  Â  Â  const currentSheetData = sheetDataCache[sheetName];
Â  Â  Â  const headers = headersCache[sheetName];
Â  Â  Â  const dateColumnIndex = 2;Â 

Â  Â  Â  const dateSet = new Set();
Â  Â  Â  for (let i = 0; i < currentSheetData.length; i++) {
Â  Â  Â  Â  const d = currentSheetData[i][dateColumnIndex];
Â  Â  Â  Â  if (d) dateSet.add(d);
Â  Â  Â  }
Â  Â  Â Â 
Â  Â  Â  const dateSelect = document.getElementById('dateSelect');
Â  Â  Â  dateSelect.innerHTML = '<option value="">å…¨éƒ¨</option>';
Â  Â  Â  [...dateSet].sort().reverse().forEach(date => {
Â  Â  Â  Â  const opt = document.createElement('option');
Â  Â  Â  Â  opt.value = date;
Â  Â  Â  Â  opt.textContent = date;
Â  Â  Â  Â  dateSelect.appendChild(opt);
Â  Â  Â  });
Â  Â  Â  processAndRender(currentSheetData, headers);
Â  Â  });
Â  Â Â 
Â  Â  document.getElementById('dateSelect').addEventListener('change', () => {
Â  Â  Â  Â  compareData();
Â  Â  });

Â  Â  function compareData() {
Â  Â  Â  const sheetName = document.getElementById('sheetSelect').value;
Â  Â  Â  const dateFilter = document.getElementById('dateSelect').value;
Â  Â  Â  if (!sheetName || !sheetDataCache[sheetName]) return;

Â  Â  Â  const currentSheetData = sheetDataCache[sheetName];
Â  Â  Â  const headers = headersCache[sheetName];
Â  Â  Â  const dateColumnIndex = 2;
Â  Â  Â Â 
Â  Â  Â  const filteredData = currentSheetData.filter(row => {
Â  Â  Â  Â  Â  if (!row.length) return false;
Â  Â  Â  Â  Â  return !dateFilter || row[dateColumnIndex] == dateFilter;
Â  Â  Â  });

Â  Â  Â  processAndRender(filteredData, headers);
Â  Â  }
Â  Â Â 
Â  Â  function processAndRender(dataRows, headers) {
Â  Â  Â  Â  const body = [];
Â  Â  Â  Â  for (let i = 0; i < dataRows.length; i++) {
Â  Â  Â  Â  Â  Â  const row = dataRows[i];
Â  Â  Â  Â  Â  Â  const item = [...row];
Â  Â  Â  Â  Â  Â  const code = (item[0] || '').replace(/-M$/, '');
Â  Â  Â  Â  Â  Â  const refRow = refSheetMap.get(code);
Â  Â  Â  Â  Â  Â  const colorMark = Array(21).fill('');

Â  Â  Â  Â  Â  Â  if (refRow) {
                // ***** é€™è£¡æ˜¯ä¿®æ”¹å¾Œçš„æ ¸å¿ƒé‚è¼¯ *****
Â  Â  Â  Â  Â  Â  Â  Â  [[5, 4, 5], [8, 6, 7], [9, 8, 9], [10, 10, 11], [11, 12, 13]].forEach(([col, low, high]) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const val = parseFloat(item[col]);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const min = parseFloat(refRow[low]);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const max = parseFloat(refRow[high]);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!isNaN(val)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!isNaN(min) && val < min) colorMark[col] = 'low';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  else if (!isNaN(max) && val > max) colorMark[col] = 'high';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  body.push({ row: item, mark: colorMark });
Â  Â  Â  Â  }
Â  Â  Â  Â  renderTable(headers, body);
Â  Â  }

Â  Â  function renderTable(headers, body) {
Â  Â  Â  Â  const output = document.getElementById('output');
Â  Â  Â  Â  output.innerHTML = '';

Â  Â  Â  Â  if (!headers || headers.length === 0) return;

Â  Â  Â  Â  if (body.length === 0) {
Â  Â  Â  Â  Â  Â  output.innerHTML = '<p style="text-align:center; padding: 2em;">åœ¨æŒ‡å®šæ¢ä»¶ä¸‹æ²’æœ‰æ‰¾åˆ°è³‡æ–™ã€‚</p>';
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  const table = document.createElement('table');
Â  Â  Â  Â  const header = document.createElement('tr');
Â  Â  Â  Â  headers.forEach(title => {
Â  Â  Â  Â  Â  Â  const th = document.createElement('th');
Â  Â  Â  Â  Â  Â  th.textContent = title;
Â  Â  Â  Â  Â  Â  header.appendChild(th);
Â  Â  Â  Â  });
Â  Â  Â  Â  table.appendChild(header);

Â  Â  Â  Â  body.forEach(({ row, mark }) => {
Â  Â  Â  Â  Â  Â  const tr = document.createElement('tr');
Â  Â  Â  Â  Â  Â  for (let i = 0; i < headers.length; i++) {
Â  Â  Â  Â  Â  Â  Â  Â  const td = document.createElement('td');
Â  Â  Â  Â  Â  Â  Â  Â  td.textContent = row[i] ?? '';
Â  Â  Â  Â  Â  Â  Â  Â  if (mark[i]) td.classList.add(mark[i]);
Â  Â  Â  Â  Â  Â  Â  Â  tr.appendChild(td);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  table.appendChild(tr);
Â  Â  Â  Â  });
Â  Â  Â  Â  output.appendChild(table);
Â  Â  }
Â  </script>
</body>
</html>